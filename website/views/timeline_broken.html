<!DOCTYPE html>
<html>
  <head lang="en">
    <title>1self - Live smarter</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="1self Dev Community View"/>
    <link rel="shortcut icon" href="/img/fav.ico" />
    <link href="/css/import.css" rel="stylesheet" media="screen" />
    <link href="/fonts/font-awesome.css" rel="stylesheet" />
    <!--[if IE 7]>
        <link rel="stylesheet" href="fonts/font-awesome.css" />
        <![endif]-->
    <!-- HTML5 shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="js/html5shiv.js"></script>
        <script src="js/respond.min.js"></script>
        <![endif]-->

    <!-- <link href="/css/timeline.css" rel="stylesheet" media="screen"/> -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <script type="text/javascript" src="/js/react.js"></script>
    <script type="text/javascript" src="/js/JSXTransformer.js"></script>
    <script type="text/javascript" src="/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="/js/jquery-ui.min.js"></script>
    <script type="text/javascript">
      var eun = "{{encodedUsername}}",
      username = "{{username}}";
      var avatarUrl = "{{avatarUrl}}";

      $(document).ready(function() {
        $("body").on('click', '.graph-link', function() {
          $(".list-container-class").hide("slide", {
            direction: "left"
          }, 300);
          if ($(window).width() <= 460) {
            $(".graph-container-class").animate({
              width: "100%"
            }, 200);
          } else {
            $(".graph-container-class").animate({
              width: "91%"
            }, 200);
          }

          $(".graph-container-class").show("slide", {
            direction: "right"
          }, 300);

          $(".graph-container-class").removeClass("righ-aligned");

          $(".graph-link").addClass("active-link");
          $(".list-link").removeClass("active-link");
        });

        $("body").on('click', '.list-link', function() {
          $(".graph-container-class").animate({
            width: "0px"
          }, 500);
          $(".graph-container-class").hide("slide", {
            direction: "left"
          }, 300);
          $(".graph-container-class").addClass("righ-aligned");

          $(".list-container-class").show("slide", {
            direction: "left"
          }, 300);
          $(".list-link").addClass("active-link");
          $(".graph-link").removeClass("active-link");
        });

        $(".graph-link").on("swipe", function() {
          $(".graph-link").click();
        });
        $(".list-link").on("swipe", function() {
          $(".list-link").click();
        });
      });
    </script>

    <script>
      (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-54838479-1', 'auto');
      ga('send', 'pageview');
    </script>

  </head>
  <body id='riverbody' class="animated fadeInDown" ng-app>
    {% include "./templates/_qd_header.html" %}
    <aside id="sidebar">
      <div>
        <div class="custom-Menu">
    <h3 class="menu-side">Menu</h3>
</div>
<!-- Menu bar end -->
<div id='menu'>
    <ul>
        <li class="highlight" "dashboardmenuitem">
            <a href='dashboard'>
                <i class="icon-dashboard" style="color:#dd2649"></i>
                <span>Dashboard</span>
                <!-- <em class="arrow-active"></em> -->
            </a>
        </li>
        <li class="selected" id='rivermenuitem'>
            <a href='timeline'>
                <i class="glyphicon glyphicon-time" ></i>
                <span>Timeline</span>
                <!-- <em class="arrow-active"></em> -->
            </a>
        </li>

        <li class="highlight" id="integrations">
            <a href='/integrations'>
                <i class="glyphicons glyphicons-time" style="color:#fff"></i>
                <span>Integrations</span>
            </a>
        </li>

        <!-- <li class="highlight" id='linkdatamenuitem'> -->
        <!--     <a href='javascript://'> -->
        <!--         <i class="glyphicon glyphicon-link" style="color:#e93d31"></i> -->
        <!--         <span data-toggle="modal" data-target="#noDataSourceMessage">Link Data</span> -->
        <!--     </a> -->
        <!-- </li> -->

        <li class="highlight" id='blogmenuitem'>
            <a href='http://blog.1self.co/' target="_blank">
                <i class="glyphicon glyphicon-edit" style="color:#00ad87"></i>
                <span>Blog</span>
            </a>
        </li>
        <li class="highlight" id='askusmenuitem'>
            <a href='http://1self.uservoice.com/' target="_blank">
                <i class="glyphicon glyphicon-comment" style="color:#cf4b9a"></i>
                <span>Ask Us Anything</span>
            </a>
        </li>
        <li class="highlight" id='getinvolvedmenuitem'>
            <a href='http://www.1self.co/developer' target="_blank">
                <i class="fa fa-github-alt" style="color:#367ec0"></i>
                <span>Get Involved</span>
            </a>
        </li>
    </ul>
</div>
<!-- Menu End -->

      </div>
    </aside>

    <div class="dashboard-wrapper">
      <div id="river" class="container"></div>
    </div>

    <script src="/js/sparkline.js"></script>
    <script src="/js/underscore-min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/daterange/moment-with-locales.min.js"></script>
    <script src="/js/bootstrap-modal.js"></script>
    <script src="/js/bootstrap-modalmanager.js"></script>
    <script src="/js/daterange/daterangepicker.js"></script>
    <script src="/js/slidebars.js"></script>
    <script src="/js/custom.js"></script>
    <script src="/js/RiverEvent.js"></script>
    <script type="text/javascript" src="/js/timeline.js"></script>

     <script type="text/jsx">
 /** @jsx React.DOM **/

   var styleNone = {
    display: 'None'
  };

  
 var River = React.createClass({
  render: function() {
    var id = 0;
    var dateGroups = this.props.data.map(function(dateGroup) {
      return <DateGroup key={++id} date={dateGroup.date} data={dateGroup.data} />
    });

    return (
      <div className="accordian-parent">
        {dateGroups}
      </div>
      );
  }
 });

  var Event = React.createClass({
    render: function() {
      return (
        <div className="details">
          <div className="float-left">
            <h4>{this.props.title}</h4>
            <PropertyList properties={this.props.properties} />        
          </div>
          <div className="time-stamp">{this.props.time}</div>
        </div>
        );
    }
  });

  var Property = React.createClass({
    render: function() {
      return (
        <div>
          <span>{this.props.name} :</span>
          <span>&ldquo;{this.props.value}&rdquo;</span>
        </div>
        );
    }
  });

  var PropertyList = React.createClass({
    render: function() {
      var properties = this.props.properties.map(function(property) {
        return <Property key={property.name} name={property.name} value={property.value} />
      });
      return (<div>{properties}</div>);
    }
  });

  var EventList = React.createClass({
    render: function() {
      var id = 0;
      var events = this.props.events.map(function(event){
        return <Event key={++id} title={event.title} time={event.time} properties={event.properties} />
      });
      return (
        <div className="clear-all list-container-class" id="list-container">
            {events}  
          </div>
        );
    }
  });

  var Chart = React.createClass({
    render: function() {
      return (
        <div className="clear-all">
             <div className="accordian-title-logo float-left height-ten-pixle hide-on-mobile"></div>
             <div className="clear-all graph-container-class accordian-heading righ-aligned" id="graph-container" style={styleNone}>
                <iframe src={this.props.chartUrl} className="graph-iframe"></iframe>
              </div>
          </div>
        );
    }
  });

  var TagGroup = React.createClass({
    render: function() {
      return (
        <div>
          <div className="accordian-title-container"><img className="accordian-title-logo float-left" src={this.props.icon} />
            <div className="accordian-heading float-left">
              <div className="width-100 center-aligned">
                <h3> {this.props.title}</h3>
                <span>From {this.props.from} to {this.props.to}</span>
              </div>
            </div>
            <span className="counter bold">{this.props.events.length}</span>
          </div>
          <div className="accordian-heading float-left">
              <span className="list-graph-toggle-container">
                <a href="#" className="graph-toggle-link border-right list-link active-link">
                <img src="img/list-icon.png" className="graph-toggle-icon"/></a>
                <a href="#" className="graph-toggle-link graph-link">
                <img src="img/graph-icon.png" className="graph-toggle-icon"/></a>
              </span>   
          </div>
          <EventList events={this.props.events}/>
          <Chart chartUrl={this.props.chartUrl} />
        </div>
        )
    }
  });

  var DateGroup = React.createClass({
    render: function() {
      return (
        <div>
          <div className="accordian-group-heading">{this.props.date}</div>
          <div id="accordion" className="accordion">
            <TagGroupList data={this.props.data} />
          </div>
        </div>
        );
    }
  });


  var TagGroupList = React.createClass({
    render: function() {
      var id = 0;
      var tagGroups = this.props.data.map(function(tagGroup) {
        return <TagGroup key={++id} title={tagGroup.title} from={tagGroup.from} to={tagGroup.to} chartUrl={tagGroup.chartUrl} events={tagGroup.events} icon={tagGroup.icon} />
      });
      return (
        <div>{tagGroups}</div>
        );
    }
  });


var renderTimeline = function(events){
  React.render(<River data={riverData} />, document.getElementById('river'));
};

function setHeader(xhr) {
    xhr.setRequestHeader('Authorization', eun);
}

var getEvents = function (skip, limit) {
    $.ajax({
        url: "/v1/users/" + username + "/events?skip=" + skip + "&limit=" + limit,
        type: 'GET',
        dataType: 'json',
        success: renderTimeline,
        error: function () {
            console.error('Problem while fetching timeline events!');
        },
        beforeSend: setHeader
    });
};

 </script>

  </body>
</html>